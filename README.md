# Paws

This demo explains how to develop a Electron and chromebook App consuming grpc services in parallel to using local indexed db in browser.

It's based on grpc-web on backend exposing CRUD services using golang and mongodb. All the components of this demo are located in docker container and are managed by docker compose.

By using grpc and protobuf the size of transferred data will be 20 times smaller and almost 10 times faster (based on my own benchmarks) compared to traditional REST.

### Angular Web Application
PawsPWA is a pretty simple angular application. It simply calls the gRPC services sending and receiving data on top http2 in binary format. protobuf handles data marshaling and gRPC handles data transfer on the network. Envoy proxy converts http1 calls to http2. Other proxy servers can be used as replacement of envoy but I just used envoy to be consistent with google gRPC web.

PawsPWA is also using service worker. It means that it can be converted to a desktop or mobile app just like a MAGIC.

Service worker will be acticated in production mode. It basically installs pawspwa application assets on client and adds logic for bacground sync. I have not used sync-manager feature and mannualy handle going offline and back online. The main reason is to avoid relying on sync-manager feature since it's not supported by all browsers yet.

PawsPWA stored data (diaries) in indexeddb abd fetches them back if device is offline so it generally will be available even if device is offline.

In order to run application in development mode run the following commands in PawsPWA directory:

- npm install
- ng serve

Then navigate to http://localhost:4200. Keep in mind that application won't act as a progressive web application in development mode.

In order to run application in production mode simply compile and execute httpserver (source located at paws/httpserver/main.go) or install node http_server inside Public folder.  

PawsPWA/httpserver, can simply run by using following command in the PawsPWA folder:

```
- cd paws/PawsPWA
- npm run build
- cd ../httpserver
- go build
- ./httpserver
```
It looks for public folder located at root which should have been generated through "npm run build".

Now simply navigate to http://localhost:9190 and browse the application.

### Chrome Extension

Application can be compiled as a chrome app or chrome extension. You can drag and drop paws.crx file in your chrome and it will be installed as app/extension.

### Electron

Application can be compiled as a electron app using the follwoing steps :

```
npm inistall
npm run build-electron
electron .
```

### gRPC (only if you want to run application in online mode, at this time application is set to work only with local indexeddb)

server/pawsgrpc/paws_grpc.pb.go is go generated file through protoc. Basically the file has been generated by running following command:

```
protoc -I=$DIR paws_grpc.proto \
  --go_out=plugins=grpc:server/pawsgrpc
```

In server/pawsgrpc/grpc.go we convert grpc calls to database calls and map grpc objects to database objects :

```
func (srv *Runner) mapDiaries(diaries ...models.Diary) []*Diary {
	grpcDiaries := []*Diary{}
	for _, diary := range diaries {

		grpcDiaries = append(grpcDiaries, &Diary{
			Id:    diary.ID.Hex(),
			Date:  diary.DiaryDate,
			Image: diary.Image,
			Note:  diary.Note,
		})
	}
	return grpcDiaries
}
```
 
The rest of the server code is pretty straightforward. in main.go and runner.go we create config object and pass it grpc server and run the server.

If you decide to run the containers individually, you have to handle mongodb either on your machine or on a seperate container and handle networking yourself, docker-compose handles all of that for you.

